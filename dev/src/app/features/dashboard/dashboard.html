<h2>Dashboard</h2>

@if (data) {
<div class="grid mt-20">
    <nz-card class="a">
        <nz-statistic [nzValue]="data.openIssues" nzTitle="Open Issues"></nz-statistic>
    </nz-card>

    <nz-card class="b">
        <nz-statistic [nzValue]="data.inProgressIssues" nzTitle="Issues In Progress"></nz-statistic>
    </nz-card>

    <nz-card class="c">
        <div class="text-bold">Last Test Result</div>

        <div class="mt-10">
            @if (data.lastTestResult) {
            <div>
                <span>{{data.lastTestResult.code}} &ndash;</span>
                {{data.lastTestResult.plan.name}}
            </div>
            <canvas #pieChartCanvas width="450" height="220" class="mt-10"></canvas>
            }
        </div>
    </nz-card>

    <nz-card class="d">
        <div class="text-bold">Open Issues</div>

        <div class="mt-20">
            <nz-table #activeIssues [nzData]="data.recentIssues">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Title</th>
                        <th>Status</th>
                        <th>Priority</th>
                        <th>Created At</th>
                    </tr>
                </thead>
                <tbody>
                    @for (issue of activeIssues.data; track issue._id) {
                        <tr>
                            <td>{{ issue.code }}</td>
                            <td><a [routerLink]="'/dashboard/issues'">{{ issue.title }}</a></td>
                            <td>{{ issue.status }}</td>
                            <td>{{ issue.priority }}</td>
                            <td>{{ issue.createdAt | date: 'short' }}</td>
                        </tr>
                    }
                </tbody>
            </nz-table>
        </div>
    </nz-card>

    <nz-card class="e">
        <div class="text-bold">Active Test Runs</div>

        <div class="mt-20">
            <nz-table #activeTestRunsTable [nzData]="data.recentTestRuns">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Plan</th>
                        <th>Started At</th>
                        <th>Progress</th>
                    </tr>
                </thead>
                <tbody>
                    @for (run of activeTestRunsTable.data; track run._id) {
                        <tr>
                            <td>{{ run.code }}</td>
                            <td><a [routerLink]="'/dashboard/run/' + run.planId + '/' + run._id">{{ run.plan.name }}</a></td>
                            <td>{{ run.createdAt | date: 'short' }}</td>
                            <td>{{ getPercentage(run) }}%</td>
                        </tr>
                    }
            </nz-table>
        </div>
    </nz-card>
</div>
}
