<nz-modal [(nzVisible)]="isVisible" (nzOnCancel)="onClose()" nzTitle="Create Issue for Edge Case" nzOkText="Create Issue" (nzOnOk)="createIssue()">
    <ng-container *nzModalContent>
      <div>
        <b>Edge Case:</b> {{ edgeCase?.title }}
        <div style="margin-top: 10px;">
          <b>Expected Result:</b> {{ edgeCase?.expectation }}
        </div>
      </div>

      <form nz-form [formGroup]="issueForm" nzLayout="vertical" class="mt-20">
        <nz-form-item>
          <nz-form-label>Title</nz-form-label>
          <input nz-input type="text" formControlName="title" />
        </nz-form-item>

        <nz-form-item>
          <nz-form-label>Description</nz-form-label>
          <textarea nz-input rows="2" formControlName="description"></textarea>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label>Images</nz-form-label>
          <nz-form-control>
            <nz-upload
              nzListType="picture-card"
              [nzFileList]="attachments || []"
            >
              <i nz-icon nzType="plus"></i>
            </nz-upload>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label>Steps to Reproduce</nz-form-label>
          <nz-form-control>
            <div formArrayName="stepsToReproduce">
            @for (step of steps.controls; track step; let i = $index) {
              @if (step.get('edit')?.value) {
              <div style="display: flex; align-items: center; margin-bottom: 8px;">
                <input
                  #stepInput
                  nz-input
                  [formControl]="$any(step.get('step'))"
                  style="flex: 1;"
                  (blur)="onStepBlur(i)"
                  (keydown)="onStepsKeyDown($event, i)"
                />
              </div>
              } @else {
              <div class="flex">
                <div style="flex: 1;">{{ step.get('step')?.value }}</div>
                <button nz-button nzType="link" (click)="editStep(i)" style="margin-left: 8px;">
                  <nz-icon nzType="edit"></nz-icon>
                </button>
                <button nz-button nzType="link" (click)="removeStep(i)" style="margin-left: 8px;">
                  <nz-icon nzType="delete"></nz-icon>
                </button>
              </div>
              }
            }
            </div>
            <button nz-button nzType="dashed" (click)="addStep()" style="width: 100%;">Add Step</button>
          </nz-form-control>
        </nz-form-item>
      </form>
    </ng-container>
</nz-modal>